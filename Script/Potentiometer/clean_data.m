clear; clc;

% ‡πÇ‡∏´‡∏•‡∏î‡πÑ‡∏ü‡∏•‡πå‡∏ï‡πâ‡∏ô‡∏â‡∏ö‡∏±‡∏ö
load('Rotary_Potentiometer_Type_C_2.mat');
output_folder = "segments_output_2";  % ‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÇ‡∏ü‡∏•‡πÄ‡∏î‡∏≠‡∏£‡πå‡πÄ‡∏Å‡πá‡∏ö‡πÑ‡∏ü‡∏•

% ‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≤‡∏Å timeseries
if isa(data, 'timeseries')
    t = data.Time;
    y = data.Data;
else
    error('‡πÑ‡∏°‡πà‡∏û‡∏ö timeseries "data"');
end

y = squeeze(y); % ‡∏•‡∏î‡∏°‡∏¥‡∏ï‡∏¥‡πÉ‡∏´‡πâ‡πÄ‡∏õ‡πá‡∏ô‡πÄ‡∏ß‡∏Å‡πÄ‡∏ï‡∏≠‡∏£‡πå 1D

% -------------------------------
% üîß ‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏ä‡πà‡∏ß‡∏á‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡∏î
% -------------------------------
%start_indices = [6040,7615,9181,10649,12306,13516,17220,19213,23264,27843];  % index ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô‡πÅ‡∏ï‡πà‡∏•‡∏∞‡∏ä‡πà‡∏ß‡∏á
start_indices = [1500,2800,5002,6047,7012,8573,10119,11434,12590,13602];
%start_indices = [2110,3488,5000,6080,7050,8404,10180,11430,12570,13640];
num_points = 30;                % ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ï‡πà‡∏≠‡∏ä‡πà‡∏ß‡∏á

% ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Ç‡∏ô‡∏≤‡∏î
n = length(y);

% -------------------------------
% ‚úÇÔ∏è ‡∏ï‡∏±‡∏î‡πÅ‡∏•‡∏∞‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÅ‡∏ï‡πà‡∏•‡∏∞‡∏ä‡πà‡∏ß‡∏á‡πÅ‡∏¢‡∏Å‡πÑ‡∏ü‡∏•‡πå
% -------------------------------
%output_folder = "segments_output_2";  % ‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÇ‡∏ü‡∏•‡πÄ‡∏î‡∏≠‡∏£‡πå‡πÄ‡∏Å‡πá‡∏ö‡πÑ‡∏ü‡∏•‡πå
if ~exist(output_folder, "dir")
    mkdir(output_folder);
end

for i = 1:length(start_indices)
    s = start_indices(i);
    e = s + num_points - 1;
    if e > n
        warning('‡∏ä‡πà‡∏ß‡∏á %d ‡πÄ‡∏Å‡∏¥‡∏ô‡∏Ç‡∏≠‡∏ö‡πÄ‡∏Ç‡∏ï‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• ‡∏ñ‡∏π‡∏Å‡∏ï‡∏±‡∏î‡πÉ‡∏´‡πâ‡∏ñ‡∏∂‡∏á %d', i, n);
        e = n;
    end

    % ‡∏ï‡∏±‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ä‡πà‡∏ß‡∏á‡∏ô‡∏µ‡πâ
    y_segment = y(s:e);
    t_segment = t(s:e);

    % ‡∏ï‡∏±‡πâ‡∏á‡∏ä‡∏∑‡πà‡∏≠‡πÑ‡∏ü‡∏•‡πå ‡πÄ‡∏ä‡πà‡∏ô segment_1.mat, segment_2.mat, ...
    filename = fullfile(output_folder, sprintf('segment_%02d.mat', i));

    % ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å
    save(filename, 't_segment', 'y_segment');

    fprintf('‚úÖ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å %s (%02d ‡∏ñ‡∏∂‡∏á %02d)\n', filename, s, e);
end

disp('üéâ ‡∏ï‡∏±‡∏î‡πÅ‡∏•‡∏∞‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÑ‡∏ü‡∏•‡πå‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß!');
